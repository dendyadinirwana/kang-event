export const HARGA = {
    // AV & Teknis
    proyektor: { nama: 'Proyektor (sewa)', sat: 'unit/hari', harga: { jakarta: 750000, bandung: 600000, surabaya: 650000, yogyakarta: 550000, medan: 600000, makassar: 600000, daerah: 500000 } },
    screen_proyektor: { nama: 'Screen Proyektor (sewa)', sat: 'unit/hari', harga: { jakarta: 300000, bandung: 250000, surabaya: 275000, yogyakarta: 225000, medan: 250000, makassar: 250000, daerah: 200000 } },
    sound_system: { nama: 'Sound System (sewa)', sat: 'paket/hari', harga: { jakarta: 2500000, bandung: 2000000, surabaya: 2200000, yogyakarta: 1800000, medan: 2000000, makassar: 2000000, daerah: 1500000 } },
    mic_podium: { nama: 'Microphone Podium/Clip', sat: 'unit/hari', harga: { jakarta: 200000, bandung: 175000, surabaya: 185000, yogyakarta: 150000, medan: 175000, makassar: 175000, daerah: 150000 } },
    mic_wireless: { nama: 'Wireless Handheld Mic', sat: 'unit/hari', harga: { jakarta: 250000, bandung: 200000, surabaya: 225000, yogyakarta: 175000, medan: 200000, makassar: 200000, daerah: 175000 } },
    laptop_presentasi: { nama: 'Laptop Presentasi (sewa)', sat: 'unit/hari', harga: { jakarta: 350000, bandung: 300000, surabaya: 325000, yogyakarta: 275000, medan: 300000, makassar: 300000, daerah: 250000 } },
    switcher: { nama: 'Video Switcher/Mixer (sewa)', sat: 'unit/hari', harga: { jakarta: 1500000, bandung: 1200000, surabaya: 1350000, yogyakarta: 1100000, medan: 1200000, makassar: 1200000, daerah: 1000000 } },
    streaming_kit: { nama: 'Live Streaming Kit (sewa)', sat: 'paket/hari', harga: { jakarta: 3500000, bandung: 3000000, surabaya: 3200000, yogyakarta: 2800000, medan: 3000000, makassar: 3000000, daerah: 2500000 } },

    // Furniture & Layout
    kursi_peserta: { nama: 'Kursi Peserta (sewa)', sat: 'unit/hari', harga: { jakarta: 25000, bandung: 20000, surabaya: 22000, yogyakarta: 18000, medan: 20000, makassar: 20000, daerah: 15000 } },
    meja_peserta: { nama: 'Meja Peserta Lipat (sewa)', sat: 'unit/hari', harga: { jakarta: 35000, bandung: 28000, surabaya: 30000, yogyakarta: 25000, medan: 28000, makassar: 28000, daerah: 22000 } },
    meja_narasumber: { nama: 'Meja Narasumber (sewa)', sat: 'unit/hari', harga: { jakarta: 150000, bandung: 125000, surabaya: 135000, yogyakarta: 110000, medan: 125000, makassar: 125000, daerah: 100000 } },
    podium: { nama: 'Podium Kayu/Akrilik (sewa)', sat: 'unit/hari', harga: { jakarta: 500000, bandung: 400000, surabaya: 450000, yogyakarta: 375000, medan: 400000, makassar: 400000, daerah: 350000 } },
    kursi_vip: { nama: 'Kursi VIP/Sofa (sewa)', sat: 'unit/hari', harga: { jakarta: 100000, bandung: 80000, surabaya: 90000, yogyakarta: 75000, medan: 80000, makassar: 80000, daerah: 65000 } },
    meja_registrasi: { nama: 'Meja Registrasi (sewa)', sat: 'unit/hari', harga: { jakarta: 100000, bandung: 80000, surabaya: 90000, yogyakarta: 75000, medan: 80000, makassar: 80000, daerah: 65000 } },
    partisi: { nama: 'Partisi Ruangan (sewa)', sat: 'panel/hari', harga: { jakarta: 75000, bandung: 60000, surabaya: 65000, yogyakarta: 55000, medan: 60000, makassar: 60000, daerah: 50000 } },
    karpet: { nama: 'Karpet Merah (sewa)', sat: 'm/hari', harga: { jakarta: 50000, bandung: 40000, surabaya: 45000, yogyakarta: 38000, medan: 40000, makassar: 40000, daerah: 35000 } },

    // Dekorasi
    backdrop: { nama: 'Backdrop / Spanduk Besar (produksi)', sat: 'mÂ²', harga: { jakarta: 85000, bandung: 70000, surabaya: 75000, yogyakarta: 65000, medan: 70000, makassar: 70000, daerah: 60000 } },
    spanduk: { nama: 'Spanduk (produksi)', sat: 'mÂ²', harga: { jakarta: 55000, bandung: 45000, surabaya: 50000, yogyakarta: 42000, medan: 45000, makassar: 45000, daerah: 38000 } },
    standing_flower: { nama: 'Standing Flower Arrangement', sat: 'rangkaian', harga: { jakarta: 650000, bandung: 500000, surabaya: 550000, yogyakarta: 450000, medan: 500000, makassar: 500000, daerah: 400000 } },
    table_flower: { nama: 'Bunga Meja / Centerpiece', sat: 'rangkaian', harga: { jakarta: 250000, bandung: 200000, surabaya: 220000, yogyakarta: 185000, medan: 200000, makassar: 200000, daerah: 175000 } },
    tanaman_pot: { nama: 'Tanaman Hias / Pot (sewa)', sat: 'pot', harga: { jakarta: 150000, bandung: 120000, surabaya: 135000, yogyakarta: 110000, medan: 120000, makassar: 120000, daerah: 100000 } },
    photo_booth: { nama: 'Photo Booth Set (sewa)', sat: 'paket', harga: { jakarta: 2500000, bandung: 2000000, surabaya: 2200000, yogyakarta: 1800000, medan: 2000000, makassar: 2000000, daerah: 1700000 } },
    lampu_hias: { nama: 'Lampu Hias / LED Dekor (sewa)', sat: 'paket', harga: { jakarta: 1500000, bandung: 1200000, surabaya: 1350000, yogyakarta: 1100000, medan: 1200000, makassar: 1200000, daerah: 1000000 } },
    nametag: { nama: 'Name Tag + Holder', sat: 'pcs', harga: { jakarta: 8000, bandung: 7000, surabaya: 7500, yogyakarta: 6500, medan: 7000, makassar: 7000, daerah: 6000 } },
    meja_backdrop: { nama: 'Frame Backdrop + Besi (sewa)', sat: 'unit', harga: { jakarta: 350000, bandung: 280000, surabaya: 300000, yogyakarta: 250000, medan: 280000, makassar: 280000, daerah: 230000 } },

    // SDM â€” SBM TA 2026 (PMK 32/2025) â€” flat rates, not regional
    mc_honor: { nama: 'Honorarium MC / Pembawa Acara', sat: 'orang/kegiatan', harga: { jakarta: 400000, bandung: 400000, surabaya: 400000, yogyakarta: 400000, medan: 400000, makassar: 400000, daerah: 400000 } },
    moderator_honor: { nama: 'Honorarium Moderator', sat: 'orang/kegiatan', harga: { jakarta: 700000, bandung: 700000, surabaya: 700000, yogyakarta: 700000, medan: 700000, makassar: 700000, daerah: 700000 } },
    narasumber_honor: { nama: 'Honorarium Narasumber (Eselon III kebawah)', sat: 'OJ', harga: { jakarta: 900000, bandung: 900000, surabaya: 900000, yogyakarta: 900000, medan: 900000, makassar: 900000, daerah: 900000 } },
    operator_honor: { nama: 'Honorarium Operator / Asrot', sat: 'orang/kegiatan', harga: { jakarta: 300000, bandung: 300000, surabaya: 300000, yogyakarta: 300000, medan: 300000, makassar: 300000, daerah: 300000 } },
    fotografer_honor: { nama: 'Honorarium Fotografer', sat: 'orang/hari', harga: { jakarta: 1500000, bandung: 1200000, surabaya: 1350000, yogyakarta: 1100000, medan: 1200000, makassar: 1200000, daerah: 1000000 } },
    videografer_honor: { nama: 'Honorarium Videografer', sat: 'orang/hari', harga: { jakarta: 2000000, bandung: 1600000, surabaya: 1800000, yogyakarta: 1500000, medan: 1600000, makassar: 1600000, daerah: 1350000 } },
    interpreter_honor: { nama: 'Honorarium Interpreter', sat: 'orang/hari', harga: { jakarta: 3000000, bandung: 2500000, surabaya: 2750000, yogyakarta: 2200000, medan: 2500000, makassar: 2500000, daerah: 2000000 } },
    notulen_honor: { nama: 'Honorarium Notulen', sat: 'orang/kegiatan', harga: { jakarta: 300000, bandung: 300000, surabaya: 300000, yogyakarta: 300000, medan: 300000, makassar: 300000, daerah: 300000 } },
    keamanan_honor: { nama: 'Honor Petugas Keamanan', sat: 'orang/hari', harga: { jakarta: 350000, bandung: 280000, surabaya: 300000, yogyakarta: 250000, medan: 280000, makassar: 280000, daerah: 230000 } },
    panitia_honor: { nama: 'Honorarium Panitia Pelaksana', sat: 'orang/kegiatan', harga: { jakarta: 300000, bandung: 300000, surabaya: 300000, yogyakarta: 300000, medan: 300000, makassar: 300000, daerah: 300000 } },

    // Konsumsi â€” SBM TA 2026 (PMK 32/2025) â€” varies by province
    snack: { nama: 'Kudapan / Coffee Break', sat: 'orang/rapat', harga: { jakarta: 24000, bandung: 20000, surabaya: 21000, yogyakarta: 19000, medan: 21000, makassar: 20000, daerah: 18000 } },
    makan_siang: { nama: 'Makan Siang (prasmanan/box)', sat: 'orang/rapat', harga: { jakarta: 57000, bandung: 48000, surabaya: 50000, yogyakarta: 45000, medan: 48000, makassar: 47000, daerah: 42000 } },
    makan_vip: { nama: 'Makan VIP/Pejabat (Eselon I keatas)', sat: 'orang/rapat', harga: { jakarta: 118000, bandung: 93000, surabaya: 95000, yogyakarta: 90000, medan: 93000, makassar: 90000, daerah: 85000 } },
    air_mineral: { nama: 'Air Mineral (galon + gelas)', sat: 'paket/hari', harga: { jakarta: 150000, bandung: 120000, surabaya: 135000, yogyakarta: 110000, medan: 120000, makassar: 120000, daerah: 100000 } },

    // Materi & Cetakan
    modul: { nama: 'Modul / Materi Cetak (jilid)', sat: 'eks', harga: { jakarta: 35000, bandung: 28000, surabaya: 30000, yogyakarta: 25000, medan: 28000, makassar: 28000, daerah: 22000 } },
    sertifikat: { nama: 'Sertifikat (cetak)', sat: 'eks', harga: { jakarta: 15000, bandung: 12000, surabaya: 13000, yogyakarta: 11000, medan: 12000, makassar: 12000, daerah: 10000 } },
    atk: { nama: 'ATK Peserta (map, bolpen, blok)', sat: 'set/orang', harga: { jakarta: 25000, bandung: 20000, surabaya: 22000, yogyakarta: 18000, medan: 20000, makassar: 20000, daerah: 16000 } },
    souvenir: { nama: 'Souvenir / Goodie Bag Peserta', sat: 'pcs', harga: { jakarta: 75000, bandung: 60000, surabaya: 65000, yogyakarta: 55000, medan: 60000, makassar: 60000, daerah: 50000 } },
    seminar_kit: { nama: 'Seminar Kit (tas + blocknote + pulpen)', sat: 'set/orang', harga: { jakarta: 85000, bandung: 70000, surabaya: 75000, yogyakarta: 65000, medan: 70000, makassar: 70000, daerah: 60000 } },
    lanyard: { nama: 'Lanyard + ID Card Holder', sat: 'pcs', harga: { jakarta: 12000, bandung: 10000, surabaya: 11000, yogyakarta: 9000, medan: 10000, makassar: 10000, daerah: 8000 } },
    flashdisk_materi: { nama: 'Flashdisk Materi (4GB)', sat: 'pcs', harga: { jakarta: 45000, bandung: 38000, surabaya: 40000, yogyakarta: 35000, medan: 38000, makassar: 38000, daerah: 32000 } },

    // Desain & Branding Digital
    desain_vbg: { nama: 'Desain Virtual Background Zoom', sat: 'paket', harga: { jakarta: 350000, bandung: 280000, surabaya: 300000, yogyakarta: 250000, medan: 280000, makassar: 280000, daerah: 220000 } },
    thumbnail_yt: { nama: 'Desain YouTube Thumbnail', sat: 'paket', harga: { jakarta: 150000, bandung: 120000, surabaya: 135000, yogyakarta: 110000, medan: 120000, makassar: 120000, daerah: 100000 } },
    video_bumper: { nama: 'Produksi Video Bumper / Opening Acara', sat: 'paket', harga: { jakarta: 750000, bandung: 600000, surabaya: 650000, yogyakarta: 550000, medan: 600000, makassar: 600000, daerah: 500000 } },

    // Venue & Logistik
    sewa_ruang: { nama: 'Sewa Ruang / Ballroom', sat: 'hari', harga: { jakarta: 15000000, bandung: 10000000, surabaya: 12000000, yogyakarta: 8000000, medan: 10000000, makassar: 10000000, daerah: 7000000 } },
    transportasi: { nama: 'Transport / Koordinasi Lapangan', sat: 'paket', harga: { jakarta: 1500000, bandung: 1200000, surabaya: 1350000, yogyakarta: 1100000, medan: 1200000, makassar: 1200000, daerah: 1000000 } },
    dokumentasi_edit: { nama: 'Editing Dokumentasi Foto/Video', sat: 'paket', harga: { jakarta: 2500000, bandung: 2000000, surabaya: 2200000, yogyakarta: 1800000, medan: 2000000, makassar: 2000000, daerah: 1500000 } },
};

export const OVERRIDE_ITEMS = [
    // Honorarium (SBM-regulated)
    { key: 'narasumber_honor', label: 'Honor Narasumber (per OJ = 60 menit)', section: 'ğŸ‘¤ Honorarium â€” SBM TA 2026 (PMK 32/2025)' },
    { key: 'moderator_honor', label: 'Honor Moderator (per kegiatan)', section: null },
    { key: 'mc_honor', label: 'Honor MC / Pembawa Acara (per kegiatan)', section: null },
    { key: 'panitia_honor', label: 'Honor Panitia (per kegiatan)', section: null },
    { key: 'operator_honor', label: 'Honor Operator/Asrot (per kegiatan)', section: null },
    { key: 'fotografer_honor', label: 'Honor Fotografer (per orang/hari)', section: null },
    { key: 'videografer_honor', label: 'Honor Videografer (per orang/hari)', section: null },
    { key: 'interpreter_honor', label: 'Honor Interpreter (per orang/hari)', section: null },
    { key: 'notulen_honor', label: 'Honor Notulen (per kegiatan)', section: null },
    // Konsumsi (SBM-regulated)
    { key: 'snack', label: 'Kudapan / Coffee Break (per orang/rapat)', section: 'â˜• Konsumsi â€” SBM TA 2026 (PMK 32/2025)' },
    { key: 'makan_siang', label: 'Makan Siang (per orang/rapat)', section: null },
    { key: 'makan_vip', label: 'Makan VIP/Pejabat (per orang/rapat)', section: null },
    // Venue & AV (harga pasar)
    { key: 'sewa_ruang', label: 'Sewa Ruang / Ballroom (per hari)', section: 'ğŸ›ï¸ Venue & AV (harga pasar/e-Katalog)' },
    { key: 'proyektor', label: 'Sewa Proyektor (per unit/hari)', section: null },
    { key: 'sound_system', label: 'Sewa Sound System (per paket/hari)', section: null },
    { key: 'streaming_kit', label: 'Sewa Streaming Kit (per paket/hari)', section: null },
    // Furniture
    { key: 'kursi_peserta', label: 'Sewa Kursi Peserta (per unit/hari)', section: 'ğŸª‘ Furniture (harga pasar)' },
    { key: 'meja_peserta', label: 'Sewa Meja Peserta (per unit/hari)', section: null },
    { key: 'kursi_vip', label: 'Sewa Kursi VIP (per unit/hari)', section: null },
    // Dekorasi
    { key: 'backdrop', label: 'Backdrop/Spanduk (per mÂ²)', section: 'ğŸŒ¸ Dekorasi (harga pasar)' },
    { key: 'standing_flower', label: 'Standing Flower (per rangkaian)', section: null },
    { key: 'table_flower', label: 'Bunga Meja (per rangkaian)', section: null },
    // Seminar Kit
    { key: 'seminar_kit', label: 'Seminar Kit (per orang)', section: 'ğŸ’ Seminar Kit' },
    { key: 'lanyard', label: 'Lanyard + ID Card Holder (per pcs)', section: null },
    { key: 'flashdisk_materi', label: 'Flashdisk Materi 4GB (per pcs)', section: null },
    // Desain Digital
    { key: 'desain_vbg', label: 'Desain Virtual Background Zoom', section: 'ğŸ¨ Desain & Branding Digital' },
    { key: 'thumbnail_yt', label: 'Desain YouTube Thumbnail', section: null },
    { key: 'video_bumper', label: 'Produksi Video Bumper / Opening Acara', section: null },
];

function h(kota, key, overrides) {
    if (overrides[key] !== undefined) return overrides[key];
    return HARGA[key]?.harga?.[kota] || HARGA[key]?.harga?.daerah || 0;
}

function row(key, kota, qty, overrides, sat_override = null, note = '') {
    const item = HARGA[key];
    if (!item) return null;
    const satuan = sat_override || item.sat;
    const harga = h(kota, key, overrides);
    const total = harga * qty;
    return { key, nama: item.nama, qty, satuan, harga, total, note };
}

export function buildRAB(input, overrides = {}) {
    const {
        location: kota = 'jakarta',
        eventType: evType = 'seminar',
        duration = 8,
        peserta = 30,
        narasumber = 2,
        moderator = 1,
        mc = 1,
        panitia = 5,
        guestClass = 'reguler',
        vvip = 0,
        vip = 0,
        team = [],
        decorChips = [],
        seatingPref: seating = 'auto'
    } = input;

    const totalPeserta = peserta + vvip + vip;
    const hari = duration <= 4 ? 1 : Math.ceil(duration / 8);
    const isGala = evType === 'gala';
    const isFGD = evType === 'fgd';
    const isExpo = evType === 'expo';
    const hasVVIP = vvip > 0 || guestClass === 'vvip';
    const hasVIP = vip > 0 || ['vip', 'vvip', 'campuran'].includes(guestClass);
    const hasSnack = duration >= 2;
    const hasMakan = duration >= 4;

    let formasi = seating;
    if (seating === 'auto') {
        if (isFGD || peserta <= 20) formasi = 'roundtable';
        else if (isGala) formasi = 'banquet';
        else if (['workshop', 'rapat'].includes(evType)) formasi = 'u-shape';
        else if (['seminar', 'konferensi', 'talkshow', 'panel'].includes(evType)) formasi = 'theater';
        else formasi = 'classroom';
    }

    let luasMin, luasIdeal;
    const tp = totalPeserta;
    if (formasi === 'theater') { luasMin = tp * 0.8; luasIdeal = tp * 1.0; }
    else if (formasi === 'classroom') { luasMin = tp * 1.2; luasIdeal = tp * 1.5; }
    else if (formasi === 'roundtable') { luasMin = tp * 1.8; luasIdeal = tp * 2.2; }
    else if (formasi === 'u-shape') { luasMin = tp * 1.5; luasIdeal = tp * 1.8; }
    else if (formasi === 'banquet') { luasMin = tp * 1.4; luasIdeal = tp * 1.8; }
    else { luasMin = tp * 1.0; luasIdeal = tp * 1.3; }

    const proyektorJml = peserta > 100 ? 2 : 1;
    const micNS = narasumber + moderator;
    const micPes = isFGD ? Math.ceil(peserta / 4) : formasi === 'roundtable' ? Math.ceil(peserta / 5) : 2;

    const kursiPesertaJml = peserta;
    const kursiVIPJml = vip;
    const kursiVVIPJml = vvip;
    const mejaPesertaJml = ['classroom', 'roundtable', 'u-shape'].includes(formasi) ? Math.ceil(peserta / 2) : 0;
    const mejaNSJml = narasumber + moderator > 0 ? 1 : 0;

    const backdropW = Math.max(6, Math.ceil(narasumber * 1.2) + 2);
    const backdropH = 3;
    const spandukJml = hasVVIP ? 3 : 2;

    const sections = [];

    const venue = [];
    venue.push(row('sewa_ruang', kota, hari, overrides, 'hari'));
    if (isExpo) venue.push({ key: 'partisi_ex', nama: 'Partisi Booth Expo (sewa)', qty: Math.ceil(totalPeserta / 10), satuan: 'panel/hari', harga: h(kota, 'partisi', overrides), total: Math.ceil(totalPeserta / 10) * h(kota, 'partisi', overrides) * hari, note: 'estimasi 10 peserta per booth' });
    sections.push({ label: 'ğŸ›ï¸ Sewa Venue & Ruangan', items: venue });

    const av = [];
    av.push(row('proyektor', kota, proyektorJml * hari, overrides));
    av.push(row('screen_proyektor', kota, proyektorJml * hari, overrides));
    av.push(row('sound_system', kota, hari, overrides, 'paket/hari'));
    if (micNS > 0) av.push(row('mic_podium', kota, micNS * hari, overrides, 'unit/hari', `${micNS} mic untuk narasumber & moderator`));
    if (micPes > 0) av.push(row('mic_wireless', kota, micPes * hari, overrides, 'unit/hari', `floor mic peserta`));
    av.push(row('laptop_presentasi', kota, hari, overrides));
    if (team.includes('live_streaming')) av.push(row('streaming_kit', kota, hari, overrides, 'paket/hari'));
    if (team.includes('live_streaming')) av.push(row('switcher', kota, hari, overrides, 'unit/hari'));
    sections.push({ label: 'ğŸ“½ï¸ Peralatan AV & Teknis', items: av });

    const furn = [];
    furn.push(row('kursi_peserta', kota, kursiPesertaJml * hari, overrides, 'unit/hari'));
    if (mejaPesertaJml > 0) furn.push(row('meja_peserta', kota, mejaPesertaJml * hari, overrides, 'unit/hari'));
    if (mejaNSJml > 0) furn.push(row('meja_narasumber', kota, mejaNSJml * hari, overrides, 'unit/hari'));
    if (hasVIP && kursiVIPJml > 0) furn.push(row('kursi_vip', kota, kursiVIPJml * hari, overrides, 'unit/hari', 'kursi VIP'));
    if (hasVVIP && kursiVVIPJml > 0) furn.push({ ...row('kursi_vip', kota, kursiVVIPJml * hari, overrides, 'unit/hari'), nama: 'Kursi VVIP / Sofa Eksekutif (sewa)', harga: h(kota, 'kursi_vip', overrides) * 1.5, total: h(kota, 'kursi_vip', overrides) * 1.5 * kursiVVIPJml * hari, note: 'harga VVIP +50%' });
    if (evType !== 'gala') furn.push(row('podium', kota, hari, overrides));
    if (team.includes('registrasi')) furn.push(row('meja_registrasi', kota, 2 * hari, overrides, 'unit/hari', '2 meja registrasi'));
    if (decorChips.includes('karpet_merah') || hasVVIP) furn.push(row('karpet', kota, 10, overrides, 'm/hari', 'karpet merah protokol'));
    sections.push({ label: 'ğŸª‘ Furniture & Tata Ruang', items: furn });

    const decor = [];
    decor.push({ ...row('backdrop', kota, backdropW * backdropH, overrides, 'mÂ²'), nama: `Backdrop Utama ${backdropW}Ã—${backdropH}m (produksi)`, note: `ukuran ${backdropW}Ã—${backdropH} meter` });
    decor.push(row('spanduk', kota, spandukJml * 6, overrides, 'mÂ²', `${spandukJml} spanduk @2Ã—3m`));
    decor.push(row('meja_backdrop', kota, 1, overrides));
    if (decorChips.includes('standing_flower') || hasVVIP) decor.push(row('standing_flower', kota, hasVVIP ? 6 : 4, overrides, 'rangkaian'));
    if (decorChips.includes('table_flower') || isGala) decor.push(row('table_flower', kota, mejaNSJml + (isGala ? Math.ceil(totalPeserta / 8) : 2), overrides, 'rangkaian'));
    if (decorChips.includes('tanaman')) decor.push(row('tanaman_pot', kota, 6, overrides, 'pot'));
    if (decorChips.includes('photo_booth') || decorChips.includes('backdrop_foto')) decor.push(row('photo_booth', kota, 1, overrides, 'paket'));
    if (decorChips.includes('lampu_hias')) decor.push(row('lampu_hias', kota, 1, overrides, 'paket'));
    sections.push({ label: 'ğŸŒ¸ Dekorasi & Properti', items: decor });

    const sdm = [];
    // SBM: narasumber per OJ (1 OJ = 60 menit), assumed 2 OJ per session per hari
    const ojPerHari = 2;
    if (narasumber > 0) sdm.push({ ...row('narasumber_honor', kota, narasumber * ojPerHari * hari, overrides, 'OJ'), note: `${narasumber} narasumber Ã— ${ojPerHari} OJ/hari Ã— ${hari} hari` });
    // SBM: moderator, MC, panitia per kegiatan (flat per event day)
    if (moderator > 0) sdm.push({ ...row('moderator_honor', kota, moderator * hari, overrides, 'orang/kegiatan'), note: `${moderator} moderator Ã— ${hari} hari` });
    if (mc > 0) sdm.push({ ...row('mc_honor', kota, mc * hari, overrides, 'orang/kegiatan'), note: `${mc} MC Ã— ${hari} hari` });
    if (panitia > 0) sdm.push({ ...row('panitia_honor', kota, panitia * hari, overrides, 'orang/kegiatan'), note: `${panitia} panitia Ã— ${hari} hari` });
    if (team.includes('asrot')) sdm.push({ ...row('operator_honor', kota, 2 * hari, overrides, 'orang/kegiatan'), note: '2 operator teknis' });
    if (team.includes('fotografer')) sdm.push(row('fotografer_honor', kota, 1 * hari, overrides));
    if (team.includes('videografer')) sdm.push(row('videografer_honor', kota, 1 * hari, overrides));
    if (team.includes('interpreter')) sdm.push(row('interpreter_honor', kota, 1 * hari, overrides));
    if (team.includes('notulen')) sdm.push({ ...row('notulen_honor', kota, 1 * hari, overrides, 'orang/kegiatan'), note: '1 notulen' });
    if (team.includes('keamanan')) sdm.push(row('keamanan_honor', kota, 3 * hari, overrides, 'orang/hari', '3 petugas keamanan'));

    // Filter out any nulls incase logic triggered push of a 0 qty or undefined 
    sections.push({ label: 'ğŸ‘¤ SDM & Honorarium', items: sdm.filter(Boolean) });

    const konsumsi = [];
    const totalHadir = totalPeserta + narasumber + moderator + mc + panitia;
    if (hasSnack) {
        const sesiSnack = duration >= 8 ? 2 : 1;
        konsumsi.push({ ...row('snack', kota, totalHadir * sesiSnack, overrides, 'orang/rapat'), note: `${sesiSnack} sesi coffee break, ${totalHadir} orang` });
    }
    if (hasMakan && !isGala) konsumsi.push({ ...row('makan_siang', kota, totalHadir, overrides), note: `${totalHadir} orang` });
    if (isGala || hasVVIP) konsumsi.push({ ...row('makan_vip', kota, (vvip + vip + narasumber + moderator + mc) || 10, overrides), note: 'gala dinner / makan VVIP' });
    konsumsi.push(row('air_mineral', kota, hari, overrides, 'paket/hari'));
    if (team.includes('konsumsi')) {
        const hariPersiapan = Math.min(hari, 2);
        const totalHariPanitia = hari + hariPersiapan;
        const hargaMakanPanitia = h(kota, 'makan_siang', overrides) * 0.8;
        konsumsi.push({ key: 'konsumsi_tim', nama: 'Konsumsi Panitia & Tim Teknis (termasuk hari setup)', qty: panitia * totalHariPanitia, satuan: 'orang/hari', harga: hargaMakanPanitia, total: panitia * totalHariPanitia * hargaMakanPanitia, note: `${panitia} panitia Ã— ${totalHariPanitia} hari (${hari} hari H + ${hariPersiapan} hari H-persiapan)` });
    }
    sections.push({ label: 'â˜• Konsumsi & Catering', items: konsumsi });

    const materi = [];
    if (totalHadir > 0) materi.push(row('nametag', kota, totalHadir, overrides));
    if (totalPeserta > 0) materi.push(row('atk', kota, totalPeserta, overrides));
    if (['seminar', 'workshop', 'konferensi', 'fgd'].includes(evType) && totalPeserta > 0) materi.push(row('modul', kota, totalPeserta, overrides));
    if (['seminar', 'workshop', 'konferensi'].includes(evType) && totalPeserta > 0) materi.push(row('sertifikat', kota, totalPeserta, overrides));
    if (hasVVIP || hasVIP || isGala) materi.push(row('souvenir', kota, (vvip + vip) || 10, overrides));
    // Seminar Kit â€” jika dipilih di Tim Pendukung
    if (team.includes('seminar_kit') && totalPeserta > 0) {
        materi.push({ ...row('seminar_kit', kota, totalPeserta, overrides, 'set/orang'), note: `${totalPeserta} peserta` });
        materi.push({ ...row('lanyard', kota, totalHadir, overrides, 'pcs'), note: `${totalHadir} orang (peserta + panitia + narasumber)` });
        if (['seminar', 'workshop', 'konferensi'].includes(evType)) {
            materi.push({ ...row('flashdisk_materi', kota, totalPeserta, overrides, 'pcs'), note: `${totalPeserta} peserta` });
        }
    }
    sections.push({ label: 'ğŸ“„ Materi & Perlengkapan Peserta', items: materi.filter(Boolean) });

    const logistik = [];
    logistik.push(row('transportasi', kota, 1, overrides, 'paket'));
    if (team.includes('fotografer') || team.includes('videografer')) logistik.push(row('dokumentasi_edit', kota, 1, overrides, 'paket'));
    sections.push({ label: 'ğŸš› Transportasi & Logistik', items: logistik });

    // Desain & Branding Digital â€” muncul jika webinar/live streaming/videografer
    const isWebinar = evType === 'webinar';
    const hasStreaming = team.includes('live_streaming');
    const hasVideografer = team.includes('videografer');
    const hasBrandingDigital = isWebinar || hasStreaming || hasVideografer;
    if (hasBrandingDigital) {
        const branding = [];
        if (isWebinar || hasStreaming) branding.push(row('desain_vbg', kota, 1, overrides, 'paket'));
        if (hasStreaming) branding.push(row('thumbnail_yt', kota, 1, overrides, 'paket'));
        if (hasVideografer || hasStreaming) branding.push(row('video_bumper', kota, 1, overrides, 'paket'));
        if (branding.length > 0) sections.push({ label: 'ğŸ¨ Desain & Branding Digital', items: branding.filter(Boolean) });
    }

    return {
        sections, formasi, luasMin: Math.round(luasMin), luasIdeal: Math.round(luasIdeal),
        proyektorJml, micNS, micPes, hari, totalHadir
    };
}

export function buildChecklist(input, formasi) {
    const { eventType: evType, team = [], vvip = 0, vip = 0, guestClass = 'reguler', duration = 8 } = input;
    const hasVVIP = vvip > 0 || guestClass === 'vvip';
    const hari = duration <= 4 ? 1 : Math.ceil(duration / 8);

    return [
        {
            cat: 'H-14 (2 Minggu Sebelum)',
            guideRef: 'biro-umum',
            items: [
                'Konfirmasi booking venue & jadwal',
                'Kirim undangan & konfirmasi narasumber',
                'Finalisasi rundown acara',
                'Order backdrop & spanduk ke vendor',
                hasVVIP ? 'Koordinasi protokol VVIP dengan pihak keamanan' : null,
                hasVVIP ? 'Siapkan jalur akses khusus VVIP' : null,
            ].filter(Boolean)
        },
        {
            cat: 'H-7 (1 Minggu Sebelum)',
            guideRef: 'administrasi',
            items: [
                'Konfirmasi jumlah peserta final',
                'Order konsumsi ke catering',
                'Konfirmasi seluruh vendor AV & dekorasi',
                'Cetak materi, modul & sertifikat',
                'Cetak name tag & ID card peserta',
                team.includes('seminar_kit') ? 'Siapkan & kemas seminar kit (tas, blocknote, pulpen, lanyard, flashdisk)' : null,
                team.includes('live_streaming') ? 'Test koneksi internet & streaming setup' : null,
                team.includes('live_streaming') ? 'Siapkan desain virtual background Zoom & kirim ke narasumber/moderator (H-3)' : null,
                evType === 'webinar' ? 'Siapkan desain virtual background Zoom & kirim ke narasumber/moderator (H-3)' : null,
                team.includes('live_streaming') ? 'Upload thumbnail YouTube & siapkan deskripsi video live stream' : null,
                'Siapkan ATK & goodie bag peserta',
            ].filter(Boolean)
        },
        {
            cat: 'H-1 (Hari Sebelum)',
            guideRef: 'teknis',
            items: [
                'Cek kondisi ruangan & layout furniture',
                'Pasang backdrop, spanduk & dekorasi',
                'Test semua peralatan AV (mic, proyektor, sound)',
                team.includes('live_streaming') ? 'Test livestream end-to-end' : null,
                (team.includes('videografer') || team.includes('live_streaming')) ? 'Pastikan video bumper/opening sudah dirender & siap diputar' : null,
                'Briefing seluruh panitia & vendor',
                hasVVIP ? 'Konfirmasi ulang rundown protokol VVIP' : null,
                'Persiapkan meja registrasi & sistem absensi',
                team.includes('konsumsi') ? 'Sediakan konsumsi tim panitia selama setup & gladi H-1' : null,
            ].filter(Boolean)
        },
        {
            cat: 'Hari H â€” Pagi',
            guideRef: 'dekorasi',
            items: [
                'Arrive H-2 jam sebelum acara',
                'Final check AV & sound',
                'Dekorasi standing flower & bunga meja',
                'Siapkan konsumsi coffee break pertama',
                hasVVIP ? 'Posisikan petugas protokol & keamanan VVIP' : null,
                'Buka meja registrasi H-1 jam',
                team.includes('fotografer') ? 'Briefing fotografer & videografer' : null,
            ].filter(Boolean)
        },
        {
            cat: 'Hari H â€” Selama Acara',
            guideRef: 'sdm',
            items: [
                'Monitor mic & sound selama sesi',
                'Catat absensi & tanda tangan peserta',
                team.includes('notulen') ? 'Notulen aktif mencatat poin diskusi' : null,
                'Distribusi konsumsi tepat waktu',
                hari > 1 ? 'Koordinasi setup ulang untuk hari berikutnya' : null,
            ].filter(Boolean)
        },
        {
            cat: 'Pasca Acara',
            guideRef: 'administrasi',
            items: [
                'Distribusi sertifikat ke peserta',
                'Kumpulkan evaluasi / feedback form',
                'Pengembalian peralatan sewa',
                team.includes('fotografer') || team.includes('videografer') ? 'Terima & review hasil dokumentasi' : null,
                'Buat laporan pertanggungjawaban (LPJ)',
                'Arsipkan dokumen RAB & kwitansi vendor',
            ].filter(Boolean)
        }
    ].filter(g => g.items.length > 0);
}
